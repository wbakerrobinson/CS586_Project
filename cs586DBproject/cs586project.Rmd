---
title: "Capstone Survey Analysis"
author: "William Baker-Robinson and Kevin Ng"
date: "3/7/2020"
output:  
 html_document:
    theme: lumen
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: no
params:
  availSurv: NA
  projSurv: NA
  eligible: NA
  projInfo: NA
  host: NA
  dbName: NA
  username: NA
  password: NA
  rendered_by_shiny: FALSE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r param vars for python}
host <- params$host
dbName <- params$dbName
username <- params$username
password <- params$password
renderVal <- 1
UpdateProgress <- function(renderVal, renderByShiny)
{
  if(renderByShiny & renderVal < 25)
  {
    shiny::setProgress(renderVal/25)
    renderVal = renderVal + 1
  }
}
```

```{python connect to database}
import psycopg2
import pandas

connected = True
dbData = False
student = 0

try:
    conn = psycopg2.connect(
      dbname = r.dbName,
      user = r.username,
      host = r.host,
      password = r.password
    )
except:
    print("ERROR: Unable to connect to database")
    connected = False
if(connected):
    cur = conn.cursor()
    cur.execute("SELECT 1 FROM information_schema.tables WHERE table_name = 'student';")
    student = cur.fetchone()
if(student is not None):
    dbData = True
```

```{r check user uploads and clean}
UpdateProgress(renderVal, params$rendered_by_shiny)
#check to see if the user uploaded any docs
userData <- FALSE
availSurvBool <- FALSE
projSurvBool <- FALSE
eligibleBool <- FALSE
projInfoBool <- FALSE
if(py$connected == TRUE){
  print("Connected to the DB this is where I am going to clean")
  if(!is.null(params$availSurv))
  {
    # if true clean
    availSurvBool <- TRUE
  }
  if(!is.null(params$projSurv))
  {
    # if true clean
    projSurvBool <- TRUE
  }
  if(!is.null(params$eligible))
  {
    # if true clean
    eligibleBool <- TRUE
  }
  if(!is.null(params$projectInfo))
  {
    # if true clean
    projectInfoBool <- TRUE
  }
  if(availSurvBool | projSurvBool | eligibleBool | projInfoBool)
  {
    userData <- TRUE
  }
}
UpdateProgress(renderVal, params$rendered_by_shiny)
```

```{python update or upload}
canQuery = False

if (connected == True and r.userData == True and dbData == False):
  print("Connected, user supplied data, and db is empty")
  # run ddl 
  # upload all...
  canQuery = True
elif (connected == True and r.userData == True and dbData == True):
  #Will create if have time for now nothing done with data just produces report.
    #find where new data starts in student avail
    #assumption is that only the survey 1 & 2 data will be uploaded and updated like this
    #compare new section to prev to check for duplicate stu id
    # keep track of all id which are duplicated
    # update info for duplicated
    # load the rest to DB
  print("For now this program does not supported the database updates")
  canQuery = True
elif (connected == True and r.userData == False and dbData == True):
  print("connected, user did not supply data, and the db has data")
  canQuery = True  
elif(connected == True and r.userData == False and dbData == False):
  print("ERROR: Connected but no data exists in the database, and no data provided to add")
else:
  print("Not connected")
```


# 20 Questions     
## Interst Level  
### List students based on project of interest:  

### Count the number of students interested in each project:  

### Which project garnered the least amount of interest?  

### Are there more students who marked low interest in all projects than students who marked high interest in all projects?  

### What is the average amount of interest for project 3?  

### How many students listed more than 5 skills or subjects that interest them the most?  

### Is there at least one pair of students where each student has similar degrees of interest in a project and where a subject that one student feels the most knowledgeable about is the same subject that the other student feels the least knowledgeable about? 

### How many students share a favorite programming language with another student who expresses the same confidence level for at least one project?  

## Availability  
### When are most students available?  

### What proportion of students are available past 6:00 Pm?  

### What proportion of students perfer times before 8:00 Am?

### What is the minimum number of time slot availabilities of any student?  

### Which students have preferred times that are not available times?  

## Skills
### What are the most common skills?  

### What are some of the least common skills?  

### Where do skills not match with eligibility criteria?  

### Of the students who expressed at least moderate interest in over half the projects, what percentage of them also expressed at least moderate confidence in their skill?   

### What is the most common skill among those who got straight Aâ€™s in their prerequisite courses?  

## Miscellaneous
### Which student left the most additional comments?  

### Is the proportion of solo workers who responded to the prompt regarding anything else to know about them greater than or less than the proportion of non-solo workers who responded?  

```{python}
if(connected):
  conn.close()
```

